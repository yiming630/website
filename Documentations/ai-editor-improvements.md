# AI编辑器改进功能说明

## 📌 新功能概述

我们对AI编辑器的交互系统进行了重大改进，现在支持**文本与操作的精确关联**，让您能够对不同的文本段落应用不同的操作。

## 🎯 核心改进

### 1. 文本-操作组合系统

之前的问题：
- ❌ 所有选中的文本和操作混在一起
- ❌ 无法指定某个操作只应用于某段特定文本
- ❌ 批量处理时缺乏精确控制

现在的解决方案：
- ✅ 每段文本可以关联特定的操作
- ✅ 清晰的视觉分组显示
- ✅ 支持对每段文本独立配置操作

### 2. 改进的工作流程

#### 步骤 1：选择第一段文本
1. 在编辑器中选中第一段需要处理的文本
2. 点击浮动的"添加到聊天"按钮
3. 该文本会作为"文本1"添加到AI面板

#### 步骤 2：为文本1添加操作
1. 点击文本1卡片，使其处于选中状态（蓝色边框）
2. 从AI功能选项中选择需要的操作
3. 这些操作会自动关联到文本1

#### 步骤 3：添加更多文本
1. 选中第二段文本，点击"添加到聊天"
2. 新文本会作为"文本2"添加
3. 重复步骤2为文本2添加不同的操作

#### 步骤 4：执行处理
1. 可选：在输入框中添加额外说明
2. 点击发送按钮
3. AI会按照每段文本的特定操作进行处理

## 🖼️ UI改进说明

### 文本-操作组显示
```
┌─────────────────────────────────────┐
│ @ 文本与操作组合：                    │
├─────────────────────────────────────┤
│ ┌───────────────────────────────┐   │
│ │ 文本 1: "第一段选中的文..."     │ × │
│ │ 关联操作：                     │   │
│ │ • 重新翻译 ×                   │   │
│ │ • 语气润色-更专业 ×             │   │
│ └───────────────────────────────┘   │
│                                     │
│ ┌───────────────────────────────┐   │
│ │ 文本 2: "第二段选中的文..."     │ × │
│ │ 关联操作：                     │   │
│ │ • 简化内容 ×                   │   │
│ │ • 语法检查 ×                   │   │
│ └───────────────────────────────┘   │
└─────────────────────────────────────┘
```

### 视觉反馈
- **选中状态**：当前活动的文本组显示蓝色边框
- **操作标签**：绿色背景显示已关联的操作
- **删除按钮**：每个文本和操作都有独立的删除按钮
- **提示信息**：未添加操作时显示黄色提示

## 💡 使用场景示例

### 场景 1：多段落不同处理
- 文本1（产品介绍）→ 润色为更专业 + 扩展内容
- 文本2（用户评论）→ 简化语言 + 提取关键信息
- 文本3（技术说明）→ 重新翻译 + 术语解释

### 场景 2：批量翻译优化
- 文本1（标题）→ 提供3个译文版本
- 文本2（正文第一段）→ 重新翻译 + 语法检查
- 文本3（正文第二段）→ 重新翻译 + 语气调整为学术风格

### 场景 3：内容理解与处理
- 文本1（复杂段落）→ 总结摘要 + 解释关键术语
- 文本2（数据段落）→ 提取关键信息 + 生成表格
- 文本3（结论段落）→ 逐句对照 + 语气润色

## 🔧 技术实现细节

### 数据结构
```typescript
interface TextActionGroup {
  textId: string
  text: string
  textLabel: string
  actions: Array<{
    id: string
    action: string
    label: string
  }>
}
```

### 状态管理
- `textActionGroups`：存储所有文本-操作组合
- `currentTextId`：当前选中的文本ID
- `mentionedItems`：全局操作（不关联特定文本）

## ⚠️ 注意事项

1. **增强功能的特殊处理**
   - "数据库检索"、"深度思考"、"联网搜索"仍作为全局功能
   - 这些功能不会被关联到特定文本

2. **操作去重**
   - 同一个操作不会重复添加到同一段文本
   - 但可以将相同操作添加到不同文本

3. **清空处理**
   - 发送消息后，所有文本组和操作会自动清空
   - 可以随时手动删除特定文本或操作

## 🚀 后续优化方向

1. **拖拽排序**：支持拖拽调整文本组的顺序
2. **操作模板**：保存常用的操作组合
3. **批量操作**：一键为所有文本添加相同操作
4. **历史记录**：保存和复用之前的文本-操作组合
5. **操作预览**：在发送前预览每个文本的处理效果

## 📝 更新日志

### v2.0.0 (2024-01-XX)
- ✨ 新增文本-操作精确关联功能
- 🎨 重新设计@引用显示区域UI
- 🔧 优化状态管理和数据结构
- 📚 添加AI使用教程功能
- ♻️ 重构代码结构，提高可维护性